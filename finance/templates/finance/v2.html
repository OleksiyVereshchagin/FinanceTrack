  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{#{% extends 'main/layout.html' %}#}
{#{% load static %}#}
{##}
{#{% block title %}–ê–Ω–∞–ª—ñ–∑ –≤–∏—Ç—Ä–∞—Ç{% endblock %}#}
{##}
{#{% block extra_css %}#}
{#    <link rel="stylesheet" href="{% static 'finance/css/base.css' %}">#}
{#    <link rel="stylesheet" href="{% static 'finance/css/charts.css' %}">#}
{#{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="analysis-container">#}
{#    <div class="filter-form">#}
{#        <form method="get">#}
{#            <div class="form-row">#}
{#                <div class="form-group">#}
{#                    <label for="id_account">–†–∞—Ö—É–Ω–æ–∫</label>#}
{#                    {{ form.account }}#}
{#                </div>#}
{##}
{#                <div class="form-group">#}
{#                    <label for="id_period">–ü–µ—Ä—ñ–æ–¥</label>#}
{#                    {{ form.period }}#}
{#                </div>#}
{##}
{#                <div class="form-group" id="custom-dates" style="display: none;">#}
{#                    <label for="id_start_date">–ó</label>#}
{#                    {{ form.start_date }}#}
{#                </div>#}
{##}
{#                <div class="form-group" id="custom-dates-end" style="display: none;">#}
{#                    <label for="id_end_date">–ü–æ</label>#}
{#                    {{ form.end_date }}#}
{#                </div>#}
{##}
{#                <button type="submit" class="btn-apply">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>#}
{#            </div>#}
{#        </form>#}
{#    </div>#}
{##}
{#    {% if no_expenses %}#}
{#        <div class="empty-message">#}
{#            –ù–µ–º–∞—î –≤–∏—Ç—Ä–∞—Ç –∑–∞ –æ–±—Ä–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.#}
{#        </div>#}
{#    {% else %}#}
{#    <div class="stats-container">#}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ total_expenses|default:"0" }} ‚Ç¥</div>#}
{#            <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ avg_per_day|default:"0" }} ‚Ç¥</div>#}
{#            <div class="stat-label">–°–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç –∑–∞ –¥–µ–Ω—å</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ top_category.category__name|default:"-" }}</div>#}
{#            <div class="stat-label">–ù–∞–π–±—ñ–ª—å—à–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏—Ç—Ä–∞—Ç</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ total_income|default:"0" }} ‚Ç¥</div>#}
{#            <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –¥–æ—Ö–æ–¥–∏</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ transaction_count|default:"0" }}</div>#}
{#            <div class="stat-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value {% if balance < 0 %}negative-balance{% else %}positive-balance{% endif %}">#}
{#                {{ balance|default:"0" }} ‚Ç¥#}
{#            </div>#}
{#            <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="charts-container">#}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–í–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="categoryChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–î–æ—Ö–æ–¥–∏ —Ç–∞ –≤–∏—Ç—Ä–∞—Ç–∏ –∑–∞ —á–∞—Å–æ–º</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="incomeExpenseChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{##}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–î–∏–Ω–∞–º—ñ–∫–∞ –≤–∏—Ç—Ä–∞—Ç</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="dailyChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–°–µ—Ä–µ–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="avgCategoryChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—Ç—Ä–∞—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="countCategoryChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    {% endif %}#}
{#</div>#}
{#{% endblock %}#}
{##}
{#{% block extra_js %}#}
{#<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>#}
{#<script>#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#        const periodSelect = document.getElementById('id_period');#}
{#        const customDates = document.getElementById('custom-dates');#}
{#        const customDatesEnd = document.getElementById('custom-dates-end');#}
{##}
{#        function toggleDateFields() {#}
{#            const isCustom = periodSelect.value === 'custom';#}
{#            customDates.style.display = isCustom ? 'block' : 'none';#}
{#            customDatesEnd.style.display = isCustom ? 'block' : 'none';#}
{#        }#}
{##}
{#        periodSelect.addEventListener('change', toggleDateFields);#}
{#        toggleDateFields();#}
{#    });#}
{##}
{#    new Chart(document.getElementById('categoryChart'), {#}
{#        type: 'doughnut',#}
{#        data: {#}
{#            labels: [{% for item in by_category %}"{{ item.category__name }}",{% endfor %}],#}
{#            datasets: [{#}
{#                data: [{% for item in by_category %}{{ item.total }},{% endfor %}],#}
{#                backgroundColor: [#}
{#                    '#C1E6CB','#A8D8EA','#F8B195','#F6D186','#FFDAC1','#B5EAD7','#C7CEEA','#FFD3B6',#}
{#                    '#E2F0CB','#FFB7B2','#D5AAFF','#A0CED9','#FFCBC1','#D0E6A5','#B5D8B2'#}
{#                ]#}
{#            }]#}
{#        }#}
{#    });#}
{##}
{#    new Chart(document.getElementById('dailyChart'), {#}
{#        type: 'line',#}
{#        data: {#}
{#            labels: [{% for item in by_day %}"{{ item.date|date:'d.m' }}",{% endfor %}],#}
{#            datasets: [{#}
{#                label: '–í–∏—Ç—Ä–∞—Ç–∏',#}
{#                data: [{% for item in by_day %}{{ item.total }},{% endfor %}],#}
{#                borderColor: '#D5AAFF'#}
{#            }]#}
{#        }#}
{#    });#}
{##}
{#    new Chart(document.getElementById('avgCategoryChart'), {#}
{#        type: 'bar',#}
{#        data: {#}
{#            labels: [{% for item in avg_by_category %}"{{ item.category__name }}",{% endfor %}],#}
{#            datasets: [{#}
{#                label: '–°–µ—Ä–µ–¥–Ω—è —Å—É–º–∞',#}
{#                data: [{% for item in avg_by_category %}{{ item.avg|floatformat:2 }},{% endfor %}],#}
{#                backgroundColor: '#A8D8EA'#}
{#            }]#}
{#        },#}
{#        options: {#}
{#            responsive: true,#}
{#            plugins: {#}
{#                legend: { display: false }#}
{#            },#}
{#            scales: {#}
{#                x: {#}
{#                    ticks: {#}
{#                        callback: function(value, index, values) {#}
{#                            let label = this.getLabelForValue(value);#}
{#                            return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;#}
{#                        },#}
{#                        autoSkip: false,#}
{#                        maxRotation: 30,#}
{#                        minRotation: 30#}
{#                    }#}
{#                }#}
{#            }#}
{#        }#}
{#    });#}
{##}
{##}
{##}
{##}
{##}
{##}
{##}
{#    new Chart(document.getElementById('countCategoryChart'), {#}
{#        type: 'bar',#}
{#        data: {#}
{#            labels: [{% for item in count_by_category %}"{{ item.category__name }}",{% endfor %}],#}
{#            datasets: [{#}
{#                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π',#}
{#                data: [{% for item in count_by_category %}{{ item.count }},{% endfor %}],#}
{#                backgroundColor: '#F6D186'#}
{#            }]#}
{#        },#}
{#        options: {#}
{#            responsive: true,#}
{#            plugins: {#}
{#                legend: { display: false }#}
{#            },#}
{#            scales: {#}
{#                x: {#}
{#                    ticks: {#}
{#                        callback: function(value, index, values) {#}
{#                            let label = this.getLabelForValue(value);#}
{#                            return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;#}
{#                        },#}
{#                        autoSkip: false,#}
{#                        maxRotation: 30,#}
{#                        minRotation: 30#}
{#                    }#}
{#                }#}
{#            }#}
{#        }#}
{#    });#}
{#</script>#}
{#{% endblock %}#}


{#-----------------------------------------#}




{% extends 'main/layout.html' %}
{% load static %}

{% block title %}–ê–Ω–∞–ª—ñ–∑ –≤–∏—Ç—Ä–∞—Ç{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'finance/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'finance/css/charts.css' %}">
{% endblock %}

{% block content %}
<div class="analysis-container">
    <div class="filter-form">
        <form method="get">
            <div class="form-row">
                <div class="form-group">
                    <label for="id_account">–†–∞—Ö—É–Ω–æ–∫</label>
                    {{ form.account }}
                </div>

                <div class="form-group">
                    <label for="id_period">–ü–µ—Ä—ñ–æ–¥</label>
                    {{ form.period }}
                </div>

                <div class="form-group" id="custom-dates" style="display: none;">
                    <label for="id_start_date">–ó</label>
                    {{ form.start_date }}
                </div>

                <div class="form-group" id="custom-dates-end" style="display: none;">
                    <label for="id_end_date">–ü–æ</label>
                    {{ form.end_date }}
                </div>

                <button type="submit" class="btn-apply">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
            </div>
        </form>
    </div>

    {% if no_expenses %}
        <div class="empty-message">–ù–µ–º–∞—î –≤–∏—Ç—Ä–∞—Ç –∑–∞ –æ–±—Ä–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.</div>
    {% else %}
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-value">{{ total_expenses|default:"0" }} ‚Ç¥</div>
            <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>
        </div>

        <div class="stat-card">
            <div class="stat-value">{{ avg_per_day|default:"0" }} ‚Ç¥</div>
            <div class="stat-label">–°–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç –∑–∞ –¥–µ–Ω—å</div>
        </div>

        <div class="stat-card">
            <div class="stat-value">{{ top_category.category__name|default:"-" }}</div>
            <div class="stat-label">–ù–∞–π–±—ñ–ª—å—à–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏—Ç—Ä–∞—Ç</div>
        </div>

        <div class="stat-card">
            <div class="stat-value">{{ total_income|default:"0" }} ‚Ç¥</div>
            <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –¥–æ—Ö–æ–¥–∏</div>
        </div>

        <div class="stat-card">
            <div class="stat-value">{{ transaction_count|default:"0" }}</div>
            <div class="stat-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</div>
        </div>

        <div class="stat-card">
            <div class="stat-value {% if balance < 0 %}negative-balance{% else %}positive-balance{% endif %}">
                {{ balance|default:"0" }} ‚Ç¥
            </div>
            <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
        </div>
    </div>

    <div class="charts-container">
        <div class="chart-card">
            <h3 class="chart-title">–í–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º</h3>
            <div class="chart-wrapper">
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-card">
            <h3 class="chart-title">–î–æ—Ö–æ–¥–∏ —Ç–∞ –≤–∏—Ç—Ä–∞—Ç–∏ –∑–∞ —á–∞—Å–æ–º</h3>
            <div class="chart-wrapper">
                <div class="chart-container">
                    <canvas id="incomeExpenseChart"></canvas>
                </div>
            </div>
        </div>
        <div class="chart-card">
            <h3 class="chart-title">–≥—Ä–∞—Ñ—ñ–∫</h3>
            <div class="chart-wrapper">
                <div class="chart-container">
                    <canvas id="avgCategoryChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-card">
            <h3 class="chart-title">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—Ç—Ä–∞—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>
            <div class="chart-wrapper">
                <div class="chart-container">
                    <canvas id="countCategoryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const periodSelect = document.getElementById('id_period');
        const customDates = document.getElementById('custom-dates');
        const customDatesEnd = document.getElementById('custom-dates-end');

        function toggleDateFields() {
            const isCustom = periodSelect.value === 'custom';
            customDates.style.display = isCustom ? 'block' : 'none';
            customDatesEnd.style.display = isCustom ? 'block' : 'none';
        }

        periodSelect.addEventListener('change', toggleDateFields);
        toggleDateFields();
    });

    new Chart(document.getElementById('categoryChart'), {
        type: 'doughnut',
        data: {
            labels: [{% for item in by_category %}"{{ item.category__name }}",{% endfor %}],
            datasets: [{
                data: [{% for item in by_category %}{{ item.total }},{% endfor %}],
                backgroundColor: [
                    '#C1E6CB','#A8D8EA','#F8B195','#F6D186','#FFDAC1','#B5EAD7','#C7CEEA','#FFD3B6',
                    '#E2F0CB','#FFB7B2','#D5AAFF','#A0CED9','#FFCBC1','#D0E6A5','#B5D8B2'
                ]
            }]
        }
    });

    new Chart(document.getElementById('dailyChart'), {
        type: 'line',
        data: {
            labels: [{% for item in by_day %}"{{ item.date|date:'d.m' }}",{% endfor %}],
            datasets: [{
                label: '–í–∏—Ç—Ä–∞—Ç–∏',
                data: [{% for item in by_day %}{{ item.total }},{% endfor %}],
                borderColor: '#D5AAFF',
                fill: false
            }]
        }
    });

    new Chart(document.getElementById('avgCategoryChart'), {
    type: 'bar',
    data: {
        labels: [{% for item in avg_by_category %}"{{ item.category__name }}",{% endfor %}],
        datasets: [{
            label: '–°–µ—Ä–µ–¥–Ω—è —Å—É–º–∞',
            data: [{% for item in avg_by_category %}{{ item.avg|floatformat:2 }},{% endfor %}],
            backgroundColor: '#A8D8EA'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false }
        },
        scales: {
            x: {
                grid: {
                    display: false // üëâ –ø—Ä–∏–±—Ä–∞—Ç–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó
                },
                ticks: {
                    callback: function(value) {
                        let label = this.getLabelForValue(value);
                        return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;
                    },
                    autoSkip: false,
                    maxRotation: 30,
                    minRotation: 30
                }
            },
            y: {
                grid: {
                    display: true,// üëâ –ø—Ä–∏–±—Ä–∞—Ç–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó
                }
            }
        }
    }
});


    new Chart(document.getElementById('avgCategoryChart'), {
        type: 'bar',
        data: {
            labels: [{% for item in avg_by_category %}"{{ item.category__name }}",{% endfor %}],
            datasets: [{
                label: '–°–µ—Ä–µ–¥–Ω—è —Å—É–º–∞',
                data: [{% for item in avg_by_category %}{{ item.avg|floatformat:2 }},{% endfor %}],
                backgroundColor: '#A8D8EA'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    ticks: {
                        callback: function(value) {
                            let label = this.getLabelForValue(value);
                            return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;
                        },
                        autoSkip: false,
                        maxRotation: 30,
                        minRotation: 30
                    }
                },
                y: {
                    grid: {
                        drawOnChartArea: true
                    }
                }
            }
        }
    });



    new Chart(document.getElementById('incomeExpenseChart'), {
       type: 'line',
       data: {
           labels: [{% for item in expenses_by_day %}"{{ item.date|date:'d.m.y' }}",{% endfor %}],
           datasets: [
               {
                   label: '–í–∏—Ç—Ä–∞—Ç–∏',
                   data: [{% for item in expenses_by_day %}{{ item.total }},{% endfor %}],
                   borderColor: '#FF6B6B',
                   backgroundColor: 'rgba(255, 107, 107, 0.2)',
                   fill: true
               },
               {
                   label: '–î–æ—Ö–æ–¥–∏',
                   data: [{% for item in incomes_by_day %}{{ item.total }},{% endfor %}],
                   borderColor: '#4ECDC4',
                   backgroundColor: 'rgba(78, 205, 196, 0.2)',
                   fill: true
               }
           ]
       },
       options: {
           responsive: true,
           plugins: {
               title: {
                   display: true,
                   text: '–î–∏–Ω–∞–º—ñ–∫–∞ –¥–æ—Ö–æ–¥—ñ–≤ —Ç–∞ –≤–∏—Ç—Ä–∞—Ç'
               }
           },
           scales: {
               x: {
                   title: {
                       display: true,
                   }
               },
               y: {
                   title: {
                       display: true,
                   }
               }
           }
       }
    });

    new Chart(document.getElementById('countCategoryChart'), {
        type: 'bar',
        data: {
            labels: [{% for item in count_by_category %}"{{ item.category__name }}",{% endfor %}],
            datasets: [{
                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π',
                data: [{% for item in count_by_category %}{{ item.count }},{% endfor %}],
                backgroundColor: '#F6D186'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        callback: function(value) {
                            let label = this.getLabelForValue(value);
                            return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;
                        },
                        autoSkip: false,
                        maxRotation: 30,
                        minRotation: 30
                    }
                },
                y: {
                    grid: {
                        display: true // ‚úÖ –∑–∞–ª–∏—à–∞—î–º–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó
                    }
                }
            }
        }
    });

    {#new Chart(document.getElementById('avgCategoryChart'), {#}
    {#    type: 'bar',#}
    {#    data: {#}
    {#        labels: [{% for item in avg_by_category %}"{{ item.category__name }}",{% endfor %}],#}
    {#        datasets: [{#}
    {#            label: '–°–µ—Ä–µ–¥–Ω—è —Å—É–º–∞',#}
    {#            data: [{% for item in avg_by_category %}{{ item.avg|floatformat:2 }},{% endfor %}],#}
    {#            backgroundColor: '#A8D8EA'#}
    {#        }]#}
    {#    },#}
    {#    options: {#}
    {#        responsive: true,#}
    {#        plugins: {#}
    {#            legend: { display: false }#}
    {#        },#}
    {#        scales: {#}
    {#            x: {#}
    {#                ticks: {#}
    {#                    callback: function(value) {#}
    {#                        let label = this.getLabelForValue(value);#}
    {#                        return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;#}
    {#                    },#}
    {#                    autoSkip: false,#}
    {#                    maxRotation: 30,#}
    {#                    minRotation: 30#}
    {#                }#}
    {#            }#}
    {#        }#}
    {#    }#}
    {#    });#}



</script>
{% endblock %}





{##}
{#{% extends 'main/layout.html' %}#}
{#{% load static %}#}
{##}
{#{% block title %}–ê–Ω–∞–ª—ñ–∑ –≤–∏—Ç—Ä–∞—Ç{% endblock %}#}
{##}
{#{% block extra_css %}#}
{#    <link rel="stylesheet" href="{% static 'finance/css/base.css' %}">#}
{#    <link rel="stylesheet" href="{% static 'finance/css/charts.css' %}">#}
{#{% endblock %}#}
{##}
{##}
{#{% block content %}#}
{#<div class="analysis-container">#}
{#    <div class="filter-form">#}
{#        <form method="get">#}
{#            <div class="form-row">#}
{#                <div class="form-group">#}
{#                    <label for="id_account">–†–∞—Ö—É–Ω–æ–∫</label>#}
{#                    {{ form.account }}#}
{#                </div>#}
{##}
{#                <div class="form-group">#}
{#                    <label for="id_period">–ü–µ—Ä—ñ–æ–¥</label>#}
{#                    {{ form.period }}#}
{#                </div>#}
{##}
{#                <div class="form-group" id="custom-dates" style="display: none;">#}
{#                    <label for="id_start_date">–ó</label>#}
{#                    {{ form.start_date }}#}
{#                </div>#}
{##}
{#                <div class="form-group" id="custom-dates-end" style="display: none;">#}
{#                    <label for="id_end_date">–ü–æ</label>#}
{#                    {{ form.end_date }}#}
{#                </div>#}
{##}
{#                <button type="submit" class="btn-apply">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>#}
{#            </div>#}
{#        </form>#}
{#    </div>#}
{##}
{##}
{#    {% if by_category %}#}
{#    <div class="stats-container">#}
{#        <!-- –ü–µ—Ä—à–∏–π —Ä—è–¥ –∫–∞—Ä—Ç–æ–∫ -->#}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ total_expenses|default:"0" }} ‚Ç¥</div>#}
{#            <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ avg_per_day|default:"0" }} ‚Ç¥</div>#}
{#            <div class="stat-label">–°–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç –∑–∞ –¥–µ–Ω—å</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ top_category.category__name|default:"-" }}</div>#}
{#            <div class="stat-label">–ù–∞–π–±—ñ–ª—å—à–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∏—Ç—Ä–∞—Ç</div>#}
{#        </div>#}
{##}
{#        <!-- –î—Ä—É–≥–∏–π —Ä—è–¥ –∫–∞—Ä—Ç–æ–∫ -->#}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ total_income|default:"0" }} ‚Ç¥</div>#}
{#            <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω—ñ –¥–æ—Ö–æ–¥–∏</div>#}
{#        </div>#}
{##}
{#        <div class="stat-card">#}
{#            <div class="stat-value">{{ transaction_count|default:"0" }}</div>#}
{#            <div class="stat-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</div>#}
{#        </div>#}
{##}
{#        <!-- –¢—É—Ç –º–æ–∂–µ –±—É—Ç–∏ —Ç—Ä–µ—Ç—è –∫–∞—Ä—Ç–∫–∞ –¥—Ä—É–≥–æ–≥–æ —Ä—è–¥—É, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ -->#}
{#        <div class="stat-card">#}
{#            <div class="stat-value {% if balance < 0 %}negative-balance{% else %}positive-balance{% endif %}">#}
{#                {{ balance|default:"0" }} ‚Ç¥#}
{#            </div>#}
{#            <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="charts-container">#}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–í–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="categoryChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–î–∏–Ω–∞–º—ñ–∫–∞ –≤–∏—Ç—Ä–∞—Ç</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="dailyChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–°–µ—Ä–µ–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="avgCategoryChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <div class="chart-card">#}
{#            <h3 class="chart-title">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—Ç—Ä–∞—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>#}
{#            <div class="chart-wrapper">#}
{#                <div class="chart-container">#}
{#                    <canvas id="countCategoryChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#    </div>#}
{##}
{#    {% else %}#}
{#    <div class="empty-message">#}
{#        –û–±–µ—Ä—ñ—Ç—å —Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –ø–µ—Ä—ñ–æ–¥ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏#}
{#    </div>#}
{#    {% endif %}#}
{##}
{#</div>#}
{#{% endblock %}#}
{##}
{##}
{#{% block extra_js %}#}
{#<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>#}
{#<script>#}
{#    document.addEventListener('DOMContentLoaded', function() {#}
{#    const periodSelect = document.getElementById('id_period');#}
{#    const customDates = document.getElementById('custom-dates');#}
{#    const customDatesEnd = document.getElementById('custom-dates-end');#}
{##}
{#    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∏–±–æ—Ä—É#}
{#    function toggleDateFields() {#}
{#        const isCustom = periodSelect.value === 'custom';#}
{#        customDates.style.display = isCustom ? 'block' : 'none';#}
{#        customDatesEnd.style.display = isCustom ? 'block' : 'none';#}
{#    }#}
{##}
{#    // –û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ–π#}
{#    periodSelect.addEventListener('change', toggleDateFields);#}
{##}
{#    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Å—Ç–∞–Ω –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ#}
{#    toggleDateFields();#}
{#    });#}
{##}
{#    // –ö—Ä—É–≥–æ–≤–∞ –¥—ñ–∞–≥—Ä–∞–º–∞#}
{#    new Chart(document.getElementById('categoryChart'), {#}
{#        type: 'doughnut',#}
{#        data: {#}
{#            labels: [{% for item in by_category %}"{{ item.category__name }}",{% endfor %}],#}
{#            datasets: [{#}
{#                data: [{% for item in by_category %}{{ item.total }},{% endfor %}],#}
{#                backgroundColor: [#}
{#                  '#C1E6CB', // –º'—è—Ç–Ω–∏–π#}
{#                  '#A8D8EA', // –±–ª–∞–∫–∏—Ç–Ω–∏–π#}
{#                  '#F8B195', // –ø–µ—Ä—Å–∏–∫–æ–≤–∏–π —Ä–æ–∂–µ–≤–∏–π#}
{#                  '#F6D186', // –ø—ñ—Å–æ—á–Ω–∏–π —Ç–µ–ø–ª–∏–π#}
{#                  '#FFDAC1', // –∞–±—Ä–∏–∫–æ—Å–æ–≤–∏–π#}
{#                  '#B5EAD7', // —Å–≤—ñ—Ç–ª–æ-–∑–µ–ª–µ–Ω–∏–π#}
{#                  '#C7CEEA', // –ª–∞–≤–∞–Ω–¥–æ–≤–∏–π#}
{#                  '#FFD3B6', // –∫—Ä–µ–º–æ–≤–∏–π –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π#}
{#                  '#E2F0CB', // —Å–≤—ñ—Ç–ª–æ-–ª–∞–π–º–æ–≤–∏–π#}
{#                  '#FFB7B2', // –Ω—ñ–∂–Ω–æ-—Ä–æ–∂–µ–≤–∏–π#}
{#                  '#D5AAFF', // —Å–≤—ñ—Ç–ª–æ-—Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π#}
{#                  '#A0CED9', // –±—ñ—Ä—é–∑–æ–≤–∏–π –ø–∞—Å—Ç–µ–ª—å–Ω–∏–π#}
{#                  '#FFCBC1', // –ø–∞—Å—Ç–µ–ª—å–Ω–æ-–∫–æ—Ä–∞–ª–æ–≤–∏–π#}
{#                  '#D0E6A5', // –ø–∞—Å—Ç–µ–ª—å–Ω–∏–π —Å–∞–ª–∞—Ç–æ–≤–∏–π#}
{#                  '#B5D8B2'  // –º'—è–∫–∏–π –∑–µ–ª–µ–Ω–æ-—Å—ñ—Ä–∏–π#}
{#                ]#}
{#            }]#}
{#        }#}
{#    });#}
{##}
{#    // –õ—ñ–Ω—ñ–π–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫#}
{#    new Chart(document.getElementById('dailyChart'), {#}
{#        type: 'line',#}
{#        data: {#}
{#            labels: [{% for item in by_day %}"{{ item.date|date:'d.m' }}",{% endfor %}],#}
{#            datasets: [{#}
{#                label: '–í–∏—Ç—Ä–∞—Ç–∏',#}
{#                data: [{% for item in by_day %}{{ item.total }},{% endfor %}],#}
{#                borderColor: '#D5AAFF',#}
{#            }]#}
{#        }#}
{#    });#}
{##}
{#        // –°–µ—Ä–µ–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö (Bar)#}
{#    new Chart(document.getElementById('avgCategoryChart'), {#}
{#        type: 'bar',#}
{#        data: {#}
{#            labels: [{% for item in avg_by_category %}"{{ item.category__name }}",{% endfor %}],#}
{#            datasets: [{#}
{#                label: '–°–µ—Ä–µ–¥–Ω—è —Å—É–º–∞',#}
{#                data: [{% for item in avg_by_category %}{{ item.avg|floatformat:2 }},{% endfor %}],#}
{#                backgroundColor: '#A8D8EA'#}
{#            }]#}
{#        },#}
{#        options: {#}
{#            responsive: true,#}
{#            plugins: {#}
{#                legend: { display: false }#}
{#            },#}
{#            scales: {#}
{#                x: {#}
{#                    ticks: {#}
{#                        callback: function(value, index, values) {#}
{#                            let label = this.getLabelForValue(value);#}
{#                            return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;#}
{#                        },#}
{#                        autoSkip: false,  // –©–æ–± –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª–æ –ø—ñ–¥–ø–∏—Å–∏#}
{#                        maxRotation: 30,#}
{#                        minRotation: 30#}
{#                    }#}
{#                }#}
{#            }#}
{#        }#}
{#    });#}
{##}
{#    // –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö (Bar)#}
{#    new Chart(document.getElementById('countCategoryChart'), {#}
{#        type: 'bar',#}
{#        data: {#}
{#            labels: [{% for item in count_by_category %}"{{ item.category__name }}",{% endfor %}],#}
{#            datasets: [{#}
{#                label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π',#}
{#                data: [{% for item in count_by_category %}{{ item.count }},{% endfor %}],#}
{#                backgroundColor: '#F6D186'#}
{#            }]#}
{#        },#}
{#        options: {#}
{#            responsive: true,#}
{#            plugins: {#}
{#                legend: { display: false }#}
{#            },#}
{#            scales: {#}
{#                x: {#}
{#                    ticks: {#}
{#                        callback: function(value, index, values) {#}
{#                            let label = this.getLabelForValue(value);#}
{#                            return label.length > 10 ? label.slice(0, 10) + '‚Ä¶' : label;#}
{#                        },#}
{#                        autoSkip: false,  // –©–æ–± –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–ª–æ –ø—ñ–¥–ø–∏—Å–∏#}
{#                        maxRotation: 30,#}
{#                        minRotation: 30#}
{#                    }#}
{#                }#}
{#            }#}
{#        }#}
{#    });#}
{##}
{#</script>#}
{#{% endblock %}#}
{##}
</title>
</head>
<body>

</body>
</html>